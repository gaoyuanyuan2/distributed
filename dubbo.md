#dubbo 默认协议Hessian(2)

## 多注册中心支持

## 多版本支持

## 异步调用

## simple监控中心

async="true"表示接口异步返回
   

## 1、负载均衡

在集群负载均衡时，Dubbo提供了多种均衡策略，缺省为random随机调用。可以自行扩展负载均衡策略

1.  Random LoadBalance

随机，按权重设置随机概率。

在一个截面上碰撞的概率高，但调用量越大分布越均匀，而且按概率使用权重后也比较均匀，有利于动态调整提供者权重。

2.  RoundRobin LoadBalance

轮循，按公约后的权重设置轮循比率。

存在慢的提供者累积请求的问题，比如：第二台机器很慢，但没挂，当请求调到第二台时就卡在那，久而久之，所有请求都卡在调到第二台上。

3.  LeastActive LoadBalance

最少活跃调用数，相同活跃数的随机，活跃数指调用前后计数差。

使慢的提供者收到更少请求，因为越慢的提供者的调用前后计数差会越大。

4.  ConsistentHash LoadBalance

一致性Hash，相同参数的请求总是发到同一提供者。

当某一台提供者挂时，原本发往该提供者的请求，基于虚拟节点，平摊到其它提供者，不会引起剧烈变动。
   
## 2、连接超时timeout

必须要设置服务的处理的超时时间

## 3、集群容错

1.  Failover cluster 失败的时候自动切换并重试其他服务器。 通过retries=2。 来设置重试次数

2.  failfast cluster 快速失败，只发起一次调用  ;写操作。比如新增记录的时候， 非幂等请求

3.  failsafe cluster 失败安全。 出现异常时，直接忽略异常

4.  failback cluster 失败自动恢复。后台记录失败请求，定时重发

5.  forking cluster 并行调用多个服务器，只要一个成功就返回。 只能应用在读请求

6.  broadcastcluster广播调用所有提供者，逐个调用。其中一台报错就会返回异常

## 4、服务的最佳实践

1. 分包

* 服务接口、请求服务模型、异常信息都放在api里面，符合重用发布等价原则，共同重用原则

* api里面放入spring的引用配置。 也可以放在模块的包目录下。 com.order/***-reference.xml

2. 粒度

* 尽可能把接口设置成粗粒度，每个服务方法代表一个独立的功能，而不是某个功能的步骤。否则就会涉及到分布式事务

* 服务接口建议以业务场景为单位划分。并对相近业务做抽象，防止接口暴增

* 不建议使用过于抽象的通用接口  T  T<泛型>，接口没有明确的语义，带来后期的维护

3. 版本

* 每个接口都应该定义版本，为后续的兼容性提供前瞻性的考虑 version（maven-snapshot）

* 建议使用两位版本号，因为第三位版本号表示的兼容性升级，只有不兼容时才需要变更服务版本

* 当接口做到不兼容升级的时候，先升级一半或者一台提供者为新版本，再将消费全部升级新版本，然后再将剩下的一半提供者升级新版本

4. 预发布环境

## 5、推荐用法

在provider端尽可能配置consumer端的属性

比如timeout、retires、线程池大小、LoadBalance

配置管理员信息

application上面配置的owner、 owner建议配置2个人以上。因为owner都能够在监控中心看到

配置dubbo缓存文件

注册中心的列表

服务提供者列表













